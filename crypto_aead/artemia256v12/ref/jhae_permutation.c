#include "jhae.h"
#include <string.h>

// AES SBOX
const unsigned char AES_SBOX[] = {
    0x63, 0x7c, 0x77, 0x7b, 0xf2, 0x6b, 0x6f, 0xc5, 0x30, 0x01, 0x67, 0x2b, 0xfe, 0xd7, 0xab, 0x76,
    0xca, 0x82, 0xc9, 0x7d, 0xfa, 0x59, 0x47, 0xf0, 0xad, 0xd4, 0xa2, 0xaf, 0x9c, 0xa4, 0x72, 0xc0,
    0xb7, 0xfd, 0x93, 0x26, 0x36, 0x3f, 0xf7, 0xcc, 0x34, 0xa5, 0xe5, 0xf1, 0x71, 0xd8, 0x31, 0x15,
    0x04, 0xc7, 0x23, 0xc3, 0x18, 0x96, 0x05, 0x9a, 0x07, 0x12, 0x80, 0xe2, 0xeb, 0x27, 0xb2, 0x75,
    0x09, 0x83, 0x2c, 0x1a, 0x1b, 0x6e, 0x5a, 0xa0, 0x52, 0x3b, 0xd6, 0xb3, 0x29, 0xe3, 0x2f, 0x84,
    0x53, 0xd1, 0x00, 0xed, 0x20, 0xfc, 0xb1, 0x5b, 0x6a, 0xcb, 0xbe, 0x39, 0x4a, 0x4c, 0x58, 0xcf,
    0xd0, 0xef, 0xaa, 0xfb, 0x43, 0x4d, 0x33, 0x85, 0x45, 0xf9, 0x02, 0x7f, 0x50, 0x3c, 0x9f, 0xa8,
    0x51, 0xa3, 0x40, 0x8f, 0x92, 0x9d, 0x38, 0xf5, 0xbc, 0xb6, 0xda, 0x21, 0x10, 0xff, 0xf3, 0xd2,
    0xcd, 0x0c, 0x13, 0xec, 0x5f, 0x97, 0x44, 0x17, 0xc4, 0xa7, 0x7e, 0x3d, 0x64, 0x5d, 0x19, 0x73,
    0x60, 0x81, 0x4f, 0xdc, 0x22, 0x2a, 0x90, 0x88, 0x46, 0xee, 0xb8, 0x14, 0xde, 0x5e, 0x0b, 0xdb,
    0xe0, 0x32, 0x3a, 0x0a, 0x49, 0x06, 0x24, 0x5c, 0xc2, 0xd3, 0xac, 0x62, 0x91, 0x95, 0xe4, 0x79,
    0xe7, 0xc8, 0x37, 0x6d, 0x8d, 0xd5, 0x4e, 0xa9, 0x6c, 0x56, 0xf4, 0xea, 0x65, 0x7a, 0xae, 0x08,
    0xba, 0x78, 0x25, 0x2e, 0x1c, 0xa6, 0xb4, 0xc6, 0xe8, 0xdd, 0x74, 0x1f, 0x4b, 0xbd, 0x8b, 0x8a,
    0x70, 0x3e, 0xb5, 0x66, 0x48, 0x03, 0xf6, 0x0e, 0x61, 0x35, 0x57, 0xb9, 0x86, 0xc1, 0x1d, 0x9e,
    0xe1, 0xf8, 0x98, 0x11, 0x69, 0xd9, 0x8e, 0x94, 0x9b, 0x1e, 0x87, 0xe9, 0xce, 0x55, 0x28, 0xdf,
    0x8c, 0xa1, 0x89, 0x0d, 0xbf, 0xe6, 0x42, 0x68, 0x41, 0x99, 0x2d, 0x0f, 0xb0, 0x54, 0xbb, 0x16
};

// S2 and D3 as a look up table
unsigned long S2D3_SBOX[1024]=
{
    0x43bb2863, 0xfe36757c, 0x20aa4477, 0xfc5a607b, 0x6ae8def2, 0x2a1b106b, 0x9f4b0c6f, 0x1f455bc5,
    0x77c19030, 0x6d140701, 0xf6eb3467, 0x7f1cd12b, 0xb618fafe, 0x132c25d7, 0xed1a50ab, 0x4dbe4376,
    0x748976ca, 0x482e8f82, 0xc3b57fc9, 0x9322727d, 0x348e6fa, 0x87f28e59, 0x576bd447, 0xb0c0d0f0,
    0x826242ad, 0xa4102cd4, 0xe9ae6fa2, 0x584a4caf, 0x98b7d59c, 0x86d67da4, 0xf8ee5f72, 0xc70140c0,
    0xe7ab04b7, 0x124f3fd, 0xf37bf893, 0xcef8f226, 0x18b98236, 0x1c0dbd3f, 0xb2acc5f7, 0x1bf164cc,
    0xc2918c34, 0xebc27aa5, 0xbec5bbe5, 0xddd4d7f1, 0x4fd25671, 0x78e008d8, 0x1ad59731, 0xe056b15,
    0xb5501c04, 0xc56d55c7, 0x16bce923, 0x703d49c3, 0xbfe14818, 0x2b3fe396, 0xd8441b05, 0xf7cfc79a,
    0x26c1507, 0xc697e12, 0x92068180, 0xbca9aee2, 0xb81d91eb, 0xa3ecf527, 0x3fef1fb2, 0xfa824a75,
    0x4b43f09, 0x253a8883, 0x7d70c42c, 0x65c9461a, 0x8dd411b, 0xf25f0b6e, 0x30ce875a, 0x338661a0,
    0x596ebf52, 0xa95da13b, 0x7e3822d6, 0x52fb18b3, 0xa534df29, 0xd1bda9e3, 0xca4ccd2f, 0x27569d84,
    0x347ab853, 0x7c5437d1, 0x0, 0xd76583ed, 0xa180e020, 0x6c30f4fc, 0x88d316b1, 0x5dda805b,
    0x470f176a, 0x199d71cb, 0xe31f3bbe, 0x7375af39, 0xe68ff74a, 0x89f7e54c, 0xeae68958, 0xaccd6dcf,
    0x114030d0, 0xd4d8def, 0x800e57aa, 0x6e5ce1fb, 0xe23bc843, 0xe4e3e24d, 0xc0fd9933, 0x4a429a85,
    0x8d43da45, 0xb474eff9, 0xda280e02, 0x490a7c7f, 0x8346b150, 0xab31b43c, 0x2f8bdc9f, 0x5a2659a8,
    0xee52b651, 0x84ba68a3, 0x5507c140, 0xf9caac8f, 0x9e6fff92, 0xf5a3d29d, 0x1e61a838, 0x6884cbf5,
    0x393735bc, 0x8abf03b6, 0xa2c806da, 0xcc94e721, 0xd6417010, 0xdb0cfdff, 0x7fcd9f3, 0xcb683ed2,
    0x76e563cd, 0xdcf0240c, 0x617d7913, 0xba7184ec, 0xe88a9c5f, 0x462be497, 0xe057dd44, 0xd42d6517,
    0x72515cc4, 0x31ea74a7, 0x241e7b7e, 0xc625b33d, 0x41d73d64, 0x32a2925d, 0xd2f54f19, 0x95fa5873,
    0xf4872160, 0xff128681, 0x3ecbec4f, 0xcdb014dc, 0x7ba8ee22, 0x1208d62a, 0x4447f190, 0xfba6b988,
    0x3a7fd346, 0x60598aee, 0x8c6729b8, 0x63116c14, 0x17981ade, 0x859e9b5e, 0xde9c310b, 0xcfdc01db,
    0x6681a0e0, 0xade99e32, 0xc449a63a, 0xb388360a, 0x51b3fe49, 0x6f781206, 0x14d0fc24, 0x5fb6955c,
    0x1d294ec2, 0xa67c39d3, 0xef7645ac, 0x2eaf2f62, 0x2953f691, 0x9c03ea95, 0xd3d1bce4, 0x26726e79,
    0x64edb5e7, 0xaea178c8, 0x75ad8537, 0x4563026d, 0x23e2a28d, 0xc9042bd5, 0x53dfeb4e, 0x37325ea9,
    0x2877056c, 0xec3ea356, 0x590ccf4, 0xd50996ea, 0x2cc33a65, 0x914e677a, 0x355e4bae, 0x69a03808,
    0x564f27ba, 0x4b666978, 0x79c4fb25, 0xa758ca2e, 0xab1541c, 0x5cfe73a6, 0x50970db4, 0xa87952c6,
    0xf2198e8, 0xa0a413dd, 0x97964d74, 0xbd8d5d1f, 0x8b9bf04b, 0x542332bd, 0x4c9ab08b, 0x218eb78a,
    0x22c65170, 0x7119ba3e, 0x3d830ab5, 0x9bff3366, 0x3ca7f948, 0xb73c0903, 0xdfb8c2f6, 0x6d82a0e,
    0x99932661, 0xaf858b35, 0x812aa457, 0xe1732eb9, 0xfd7e9386, 0xaa1547c1, 0x67a5531d, 0x429fdb9e,
    0xb95a7e1, 0xd960e8f8, 0x2de7c998, 0xbb557711, 0xf0331e69, 0x15f40fd9, 0x94deab8e, 0xf117ed94,
    0x9adbc09b, 0xd0995a1e, 0x906a9487, 0x62359fe9, 0xc1d96ace, 0x5b02aa55, 0xc820d828, 0x7a8c1ddf,
    0x4ef6a58c, 0x5e9266a1, 0x96b2be89, 0xb1e4230d, 0x8e0b3cbf, 0x9f9b2e6, 0x8f2fcf42, 0x9d271968,
    0x3813c641, 0x40f3ce99, 0x1064c32d, 0x6bcc2d0f, 0xe5c711b0, 0x3616ad54, 0x3b5b20bb, 0xb9396216,
    0x30b3934b, 0x32c14309, 0x6ab9ee33, 0x52bd3a1b, 0x95ae362c, 0xe74a0b7b, 0x8b74763, 0x7c41e9e,
    0xf21651a0, 0x7b7f1306, 0xdf4edf53, 0x1f99cdfa, 0xadaae204, 0x46cd09f2, 0x740c4afb, 0x11c6fd35,
    0xb041ffbc, 0x9f6ba10d, 0x3fc0cab6, 0x49be500f, 0x4257ae1c, 0xe1a27cd7, 0x98afbf93, 0x61501020,
    0x6f0f20ef, 0xc94c3cf8, 0xd88ac1cd, 0x9bf106e3, 0xe6666249, 0xc389abd9, 0xfe3bb12d, 0x93464180,
    0xf9ffafb3, 0x222bd70e, 0x51e3836b, 0x5ce20ad4, 0xe9153bb4, 0x4593b082, 0x12c6932, 0xab4295a8,
    0x1deb1db8, 0xb8f6b8df, 0x40257e5e, 0x1a2f0326, 0x71ba8427, 0xf148e8d0, 0x896942a6, 0x21756e7e,
    0xeffd4c18, 0xf33a3892, 0xc86055ca, 0x1cc7748a, 0x620ea950, 0xc561dc75, 0x94825f1e, 0xfd65085d,
    0x607c7912, 0x4109176c, 0x6b958701, 0x2059074c, 0x8cdf8c7a, 0x279d19d2, 0x6d7df0ad, 0x9e47c83f,
    0xac868b36, 0xe414b20b, 0x7fe5b4e8, 0x96f08f5c, 0xed8f9c5a, 0x73c85465, 0x6e2349dd, 0x2c74e7c1,
    0xb9dad1ed, 0xaa6efc9a, 0x3db21af4, 0x1602e3ab, 0xeb67ebf6, 0x5b26144a, 0xf06481e2, 0x8468cb19,
    0xc2a5c2eb, 0x5dce63e6, 0x0, 0x97dce66e, 0x47e160c0, 0x5954c408, 0xe2fcc5a7, 0x155c5adb,
    0x9c35187d, 0xcb3eecba, 0x55792485, 0x5e90da96, 0xdbd478bd, 0xc0d712a9, 0x9add6fd1, 0x24c3a0a2,
    0x26b170e0, 0x6322c062, 0xf7359fd, 0x3928bd1a, 0x7752f38b, 0xbba801af, 0x7d9764aa, 0xff17d81f,
    0x6c51999f, 0xcdd69b16, 0xf4fe260c, 0xbd407603, 0x4d24f7e1, 0xca128588, 0x69e75743, 0xfb8d7ff1,
    0x365be4e7, 0xa3f5d2cb, 0xf8d3c681, 0xdc106623, 0x2a9c906d, 0x9d19714f, 0x25efc990, 0xf5d24f3e,
    0xa1870289, 0x8280bcb5, 0x5b6cedc, 0x3c9e73c6, 0xb5f73160, 0xd6d5f102, 0xeed1252a, 0xd24f56ec,
    0xd03d86ae, 0x3804d428, 0x3a76046a, 0xeca3f568, 0xfaa116c3, 0xbe1ecf73, 0x172e8a99, 0xd58b4872,
    0x7cbb0d98, 0x4c089ed3, 0xc63f6505, 0xb16d968e, 0x50cfea59, 0xe5f30cf, 0x1971ba56, 0x8544a22b,
    0xbf32a641, 0x10ea9407, 0x4f5627a3, 0x1eb5a4c8, 0xb31f46cc, 0x64e6defc, 0xde62b661, 0xbc6c1f31,
    0xe3d0ac95, 0x185dd364, 0x4e7a4e91, 0x5a0a7d78, 0xea4b82c4, 0x81de05c5, 0x5878ad3a, 0x7ec9ddda,
    0xd4a72140, 0x6e877ac, 0xd111ef9c, 0x2307be3c, 0x54554db7, 0x1b036a14, 0xa81c2cd8, 0x752023c9,
    0x67b8678c, 0xa93045ea, 0x147033e9, 0x4bcc804d, 0xa51da567, 0x4ae0e97f, 0x3b5a6d58, 0xa6431c17,
    0xb4db5852, 0x44bfd9b0, 0x926a28b2, 0xfc49616f, 0x28ee402f, 0xb2332ffe, 0x342934a5, 0x80f26cf7,
    0x87367269, 0x56279df5, 0x8ead5c38, 0xf7a09f7c, 0x2bb0f95f, 0x29c2291d, 0xe08e15e5, 0xd7f99830,
    0xba84689d, 0xdd3c0f11, 0xd3633fde, 0x8b1b92e4, 0x8df3e548, 0x37778dd5, 0x767e9ab9, 0x88452b94,
    0x35eb970, 0x65cab7ce, 0xe538db39, 0x272d042, 0xa0ab6bbb, 0xdaf8118f, 0x33ed2a3b, 0x4892393d,
    0xac59721, 0x3eeca384, 0xd0189bf, 0xa431cc55, 0x2f2a5eb1, 0x8f81350a, 0x7a537a34, 0xccfaf224,
    0xc44db547, 0x66940ebe, 0x2d588ef3, 0x35055d97, 0x7096ed15, 0xe8395286, 0xf68cf64e, 0x12984445,
    0xafd83246, 0xb6a98810, 0x99b2e51, 0xce882266, 0x13b42d77, 0x8a37fbd6, 0xa76f7525, 0x319ffa79,
    0x861a1b5b, 0x790dc344, 0xbe9fe13, 0x7821aa76, 0x5fbcb3a4, 0xd9a6a8ff, 0x9018f8f0, 0x913491c2,
    0x53915329, 0x570bf4c7, 0xc7130c37, 0x437bc72e, 0x2e063783, 0xcfa44b54, 0xc2de08d, 0x68cb3e71,
    0x83acd587, 0x72e43d57, 0x49aa7ee, 0xb785e122, 0x9983d6a1, 0xa2d9bbf9, 0xc1fb7b9b, 0xaef45b74,
    0xf0286363, 0x3f757c7c, 0x99447777, 0x41607b7b, 0xc4def2f2, 0x60106b6b, 0x280c6f6f, 0xdb5bc5c5,
    0x61903030, 0x12070101, 0xb8346767, 0xe6d12b2b, 0x1cfafefe, 0xde25d7d7, 0xe150abab, 0x8b437676,
    0x3576caca, 0x238f8282, 0x37fc9c9, 0x2d727d7d, 0x54e6fafa, 0x258e5959, 0xf8d44747, 0xe0d0f0f0,
    0x8d42adad, 0xe82cd4d4, 0x636fa2a2, 0xa94cafaf, 0xfed59c9c, 0xf7da4a4, 0xc35f7272, 0x8140c0c0,
    0x1804b7b7, 0x2af3fdfd, 0x10f89393, 0x2cf22626, 0xd823636, 0x8fbd3f3f, 0x9ec5f7f7, 0x5964cccc,
    0x298c3434, 0x1d7aa5a5, 0x9bbbe5e5, 0xf2d7f1f1, 0xf5567171, 0x3008d8d8, 0x73973131, 0x7b6b1515,
    0x481c0404, 0xff55c7c7, 0x76e92323, 0xb749c3c3, 0xb1481818, 0x4ae39696, 0x5a1b0505, 0x92c79a9a,
    0x7e150707, 0x57e1212, 0x7818080, 0xe5aee2e2, 0x6791ebeb, 0x3ef52727, 0x421fb2b2, 0xbd4a7575,
    0x823f0909, 0x31888383, 0x98c42c2c, 0x95461a1a, 0x87411b1b, 0x3a0b6e6e, 0x13875a5a, 0x4761a0a0,
    0x83bf5252, 0xc7a13b3b, 0xcc22d6d6, 0x5018b3b3, 0xc2df2929, 0xf7a9e3e3, 0xaecd2f2f, 0x4f9d8484,
    0x91b85353, 0xb237d1d1, 0x0, 0xb83eded, 0x40e02020, 0x38f4fcfc, 0x7416b1b1, 0x1805b5b,
    0x72176a6a, 0x2771cbcb, 0x9a3bbebe, 0xe3af3939, 0x32f74a4a, 0x5ee54c4c, 0x37895858, 0x6f6dcfcf,
    0xa030d0d0, 0x2f8defef, 0xf357aaaa, 0x46e1fbfb, 0xb0c84343, 0x4ce24d4d, 0x57993333, 0x5d9a8585,
    0xdcda4545, 0x62eff9f9, 0x240e0202, 0x97c7f7f, 0xa7b15050, 0xb9b43c3c, 0xc8dc9f9f, 0xd759a8a8,
    0xb5b65151, 0x7168a3a3, 0x86c14040, 0xe9ac8f8f, 0x2ff9292, 0xecd29d9d, 0xf1a83838, 0xbacbf5f5,
    0xbe35bcbc, 0xa03b6b6, 0x1406dada, 0x52e72121, 0x21701010, 0xefdffff, 0xd6d9f3f3, 0x843ed2d2,
    0x4b63cdcd, 0xd8240c0c, 0x17791313, 0x1984ecec, 0x499c5f5f, 0x58e49797, 0xcedd4444, 0x5f651717,
    0xc95cc4c4, 0x3974a7a7, 0x1b7b7e7e, 0xabb33d3d, 0x8e3d6464, 0x6d925d5d, 0xa34f1919, 0xd1587373,
    0xc6216060, 0x15868181, 0x68ec4f4f, 0x7814dcdc, 0x64ee2222, 0xf4d62a2a, 0x26f19090, 0x97b98888,
    0xead34646, 0x3d8aeeee, 0xf629b8b8, 0x696c1414, 0x5c1adede, 0x5b9b5e5e, 0xa6310b0b, 0x601dbdb,
    0xc1a0e0e0, 0x459e3232, 0xd5a63a3a, 0xb4360a0a, 0x4fe4949, 0x6c120606, 0x8fc2424, 0x7f955c5c,
    0xa54ec2c2, 0x9639d3d3, 0x9f45acac, 0xe22f6262, 0x34f69191, 0x7cea9595, 0x89bce4e4, 0x656e7979,
    0xbfb5e7e7, 0x1178c8c8, 0x1f853737, 0xc026d6d, 0xcda28d8d, 0xfa2bd5d5, 0x7aeb4e4e, 0xc55ea9a9,
    0x1e056c6c, 0xcba35656, 0xa8ccf4f4, 0x7596eaea, 0x9c3a6565, 0x53677a7a, 0xbb4baeae, 0x90380808,
    0xd227baba, 0x77697878, 0x1afb2525, 0xbcca2e2e, 0xf9541c1c, 0x2b73a6a6, 0x2e0db4b4, 0xed52c6c6,
    0x5198e8e8, 0x6a13dddd, 0xaf4d7474, 0xcf5d1f1f, 0x20f04b4b, 0xac32bdbd, 0xa1b08b8b, 0xb3b78a8a,
    0xe7517070, 0x9dba3e3e, 0x3c0ab5b5, 0xaa336666, 0x16f94848, 0x36090303, 0x8cc2f6f6, 0xfc2a0e0e,
    0xd4266161, 0x3b8b3535, 0xd9a45757, 0xe42eb9b9, 0x6b938686, 0x9347c1c1, 0xeb531d1d, 0xdadb9e9e,
    0xd3a7e1e1, 0x70e8f8f8, 0xb6c99898, 0x33771111, 0x441e6969, 0x220fd9d9, 0xfbab8e8e, 0x6eed9494,
    0x80c09b9b, 0xdd5a1e1e, 0x79948787, 0x439fe9e9, 0x7d6acece, 0xfdaa5555, 0xd0d82828, 0x4e1ddfdf,
    0xdfa58c8c, 0x5566a1a1, 0x85be8989, 0xca230d0d, 0x883cbfbf, 0xadb2e6e6, 0xa2cf4242, 0x56196868,
    0x94c64141, 0xa4ce9999, 0x8ac32d2d, 0xee2d0f0f, 0x6611b0b0, 0xefad5454, 0xc020bbbb, 0x4d621616,
    0xe043bb28, 0x8ffe3675, 0xa420aa44, 0x94fc5a60, 0xc96ae8de, 0xc62a1b10, 0xd09f4b0c, 0x61f455b,
    0xd477c190, 0x56d1407, 0xf6f6eb34, 0xad7f1cd1, 0xf9b618fa, 0x5c132c25, 0xd3ed1a50, 0xa14dbe43,
    0x3b748976, 0x76482e8f, 0x36c3b57f, 0x8a932272, 0xef0348e6, 0x1a87f28e, 0x70576bd4, 0xc1b0c0d0,
    0xcd826242, 0x51a4102c, 0xf0e9ae6f, 0xc5584a4c, 0x1c98b7d5, 0xee86d67d, 0xb7f8ee5f, 0x15c70140,
    0xb1e7ab04, 0xf40124f3, 0x21f37bf8, 0x98cef8f2, 0xca18b982, 0xe91c0dbd, 0xdab2acc5, 0x251bf164,
    0xc2c2918c, 0xebebc27a, 0x80bec5bb, 0xc4ddd4d7, 0xba4fd256, 0x6178e008, 0xd11ad597, 0x410e056b,
    0x16b5501c, 0xec56d55, 0x8b16bce9, 0x18703d49, 0x74bfe148, 0x322b3fe3, 0x13d8441b, 0x2f7cfc7,
    0x1b026c15, 0x5a0c697e, 0x7e920681, 0x9bbca9ae, 0xb8b81d91, 0x9da3ecf5, 0xa23fef1f, 0xacfa824a,
    0x2304b43f, 0x73253a88, 0xb67d70c4, 0x7c65c946, 0x7908dd41, 0xd5f25f0b, 0x1730ce87, 0xf8338661,
    0x31596ebf, 0xffa95da1, 0x597e3822, 0xa752fb18, 0xa5a534df, 0x9ed1bda9, 0xbbca4ccd, 0x6827569d,
    0x34347ab8, 0x427c5437, 0x0, 0xa6d76583, 0x86a180e0, 0xf16c30f4, 0xaf88d316, 0x125dda80,
    0xc3470f17, 0x3e199d71, 0x92e31f3b, 0xf77375af, 0x45e68ff7, 0x5b89f7e5, 0x1feae689, 0x28accd6d,
    0x47114030, 0xae0d4d8d, 0xd6800e57, 0xea6e5ce1, 0x66e23bc8, 0x5ee4e3e2, 0xd9c0fd99, 0x6d4a429a,
    0x788d43da, 0xe2b474ef, 0x8da280e, 0x82490a7c, 0x398346b1, 0xe4ab31b4, 0x112f8bdc, 0xde5a2659,
    0x3cee52b6, 0xf584ba68, 0x6b5507c1, 0x43f9caac, 0x249e6fff, 0x19f5a3d2, 0xf21e61a8, 0xd26884cb,
    0x9a393735, 0xb48abf03, 0x69a2c806, 0x83cc94e7, 0x52d64170, 0xfcdb0cfd, 0xcc07fcd9, 0x4fcb683e,
    0x2076e563, 0x30dcf024, 0x5f617d79, 0xa3ba7184, 0x4e88a9c, 0x37462be4, 0x7de057dd, 0x49d42d65,
    0x372515c, 0xe331ea74, 0x87241e7b, 0xe1c625b3, 0xfb41d73d, 0xc32a292, 0x71d2f54f, 0xb295fa58,
    0xedf48721, 0x7bff1286, 0x563ecbec, 0x77cdb014, 0x8e7ba8ee, 0xa81208d6, 0x2c4447f1, 0x58fba6b9,
    0x753a7fd3, 0xab60598a, 0x8c8c6729, 0x4463116c, 0x7f17981a, 0x1859e9b, 0x2bde9c31, 0x6ccfdc01,
    0x936681a0, 0xdcade99e, 0xfac449a6, 0x2eb38836, 0x4851b3fe, 0x1e6f7812, 0x9014d0fc, 0x95fb695,
    0x1d1d294e, 0x4aa67c39, 0xc8ef7645, 0xe52eaf2f, 0x292953f6, 0x3f9c03ea, 0x85d3d1bc, 0x9c26726e,
    0x8864edb5, 0x33aea178, 0xcf75ad85, 0xd8456302, 0x4b23e2a2, 0x54c9042b, 0x5353dfeb, 0xdb37325e,
    0xdd287705, 0x27ec3ea3, 0xd70590cc, 0xbdd50996, 0xfe2cc33a, 0x91914e67, 0xc0355e4b, 0x2669a038,
    0x84564f27, 0x994b6669, 0x9579c4fb, 0xbea758ca, 0x620ab154, 0xe65cfe73, 0xbc50970d, 0xba87952,
    0xb50f2198, 0x72a0a413, 0xa997964d, 0x6fbd8d5d, 0x408b9bf0, 0x9f542332, 0x554c9ab0, 0x50218eb7,
    0xbf22c651, 0xec7119ba, 0xb93d830a, 0xf39bff33, 0x4d3ca7f9, 0xdb73c09, 0xdfdfb8c2, 0x3806d82a,
    0xe8999326, 0xc7af858b, 0x22812aa4, 0x89e1732e, 0x60fd7e93, 0x10aa1547, 0x6767a553, 0x14429fdb,
    0x960b95a7, 0xe7d960e8, 0xa2de7c9, 0x57bb5577, 0xcef0331e, 0x6415f40f, 0x4694deab, 0x3af117ed,
    0x79adbc0, 0x6ad0995a, 0x65906a94, 0xb062359f, 0x2dc1d96a, 0x2a5b02aa, 0xa0c820d8, 0x7a7a8c1d,
    0x4e4ef6a5, 0xfd5e9266, 0x5d96b2be, 0x35b1e423, 0x978e0b3c, 0x8d09f9b2, 0x638f2fcf, 0xcb9d2719,
    0x6e3813c6, 0xf40f3ce, 0xb31064c3, 0x3d6bcc2d, 0xaae5c711, 0x2f3616ad, 0x813b5b20, 0x4cb93962
};

// The constants of Artemia âˆ’ 512 in the hexadecimal
// Nonzero bytes indeces: 0-3
const unsigned char C0[64] = {0x3b, 0x2d, 0x1e, 0x0f, 0x00, 0x00, 0x00, 0x00,
                              0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                              0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                              0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                              0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                              0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                              0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                              0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00};

// Nonzero bytes indeces: 16-19
const unsigned char C1[64] = {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                              0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                              0x78, 0x69, 0x5a, 0x4b, 0x00, 0x00, 0x00, 0x00,
                              0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                              0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                              0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                              0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                              0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00};

// Nonzero bytes indeces: 32-35
const unsigned char C2[64] = {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                              0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                              0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                              0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                              0xb4, 0xa5, 0x96, 0x87, 0x00, 0x00, 0x00, 0x00,
                              0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                              0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                              0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00};

// Nonzero bytes indeces: 48-51
const unsigned char C3[64] = {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                              0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                              0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                              0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                              0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                              0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                              0xf0, 0xe1, 0xd2, 0xc3, 0x00, 0x00, 0x00, 0x00,
                              0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00};

// Nonzero bytes indeces: 4-7
const unsigned char C4[64] = {0x00, 0x00, 0x00, 0x00, 0x5a, 0x4b, 0x3c, 0x2d,
                              0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                              0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                              0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                              0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                              0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                              0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                              0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00};

// Nonzero bytes indeces: 36-40
const unsigned char C5[64] = {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                              0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                              0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                              0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                              0x00, 0x00, 0x00, 0x00, 0x96, 0x87, 0x78, 0x69,
                              0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                              0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                              0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00};

const unsigned char *C[6] = {C0, C1, C2, C3, C4, C5};

void transformation_D1(unsigned char *x0, unsigned char *x1, unsigned char *x2, unsigned char *x3);
void transformation_D2(unsigned char *x0, unsigned char *x1, unsigned char *x2, unsigned char *x3);
void transformation_D3(unsigned char *x0, unsigned char *x1, unsigned char *x2, unsigned char *x3);

// Artemia-permutation-512
void artemia_permutation(unsigned char *X,
                         unsigned char *Y)
{
    int round, i;
    unsigned long temp;
    // Copy X into Y
    memcpy(Y, X, 2 * BLOCK_BYTE_SIZE * sizeof(unsigned char));

    for(round = 0 ; round < 6 ; round++){
        // XOR(X,C)
        for(i=0 ; i < 2*BLOCK_BYTE_SIZE ; i++)
            Y[i] ^= C[round][i];

        // D1
        transformation_D1(Y, Y+16, Y+32, Y+48);

        // S1
        for(i=0 ; i < 2*BLOCK_BYTE_SIZE ; i++)
            Y[i] = AES_SBOX[Y[i]];

        // D2
        transformation_D2(Y, Y+4, Y+8, Y+12);
        transformation_D2(Y+16, Y+20, Y+24, Y+28);
        transformation_D2(Y+32, Y+36, Y+40, Y+44);
        transformation_D2(Y+48, Y+52, Y+56, Y+60);

//        // S2
//        for(i=0 ; i < 2*BLOCK_BYTE_SIZE ; i++)
//            Y[i] = AES_SBOX[Y[i]];

//        // D3
//        for(i=0 ; i<2*BLOCK_BYTE_SIZE ; i+=4)
//            transformation_D3(Y+i, Y+i+1, Y+i+2, Y+i+3);

        // S2 & D3
        for(i=0 ; i<2*BLOCK_BYTE_SIZE ; i+=4){
            temp = S2D3_SBOX[Y[i]] ^
                   S2D3_SBOX[Y[i+1]+256] ^
                   S2D3_SBOX[Y[i+2]+512] ^
                   S2D3_SBOX[Y[i+3]+768];
            Y[i] = temp & 0xff;
            Y[i+1] = (temp >> 8) & 0xff;
            Y[i+2] = (temp >> 16) & 0xff;
            Y[i+3] = (temp >> 24) & 0xff;
        }

        // S3
        for(i=0 ; i < 2*BLOCK_BYTE_SIZE ; i++)
            Y[i] = AES_SBOX[Y[i]];
    }
}

void transformation_D1(unsigned char *x0,
                       unsigned char *x1,
                       unsigned char *x2,
                       unsigned char *x3)
{
    // Y0 = X0 ^ X2 ^ X3 ^ L(X1 ^ X3)
    // Y1 = X1 ^ X3 ^ Y0 ^ L(X2 ^ Y0)
    // Y2 = X2 ^ Y0 ^ Y1 ^ L(X3 ^ Y1)
    // Y3 = X3 ^ Y1 ^ Y2 ^ L(Y0 ^ Y2)
    //
    // L(X) = (X<<1) ^ (X>>3)

    const int LEN = 128;
    unsigned char temp[LEN/8];
    int i;
    unsigned char extL = 0, extR = 0, L = 0;

    // Compute Y0
    for(i=0 ; i<LEN/8 ; i++)    // temp = x1 ^ x3
        temp[i] = x1[i] ^ x3[i];

    for(i=0 ; i<LEN/8 ; i++){
        extL = i == 0 ? temp[0] << 1 : (temp[i] << 1) | (temp[i-1] >> 7);
        extR = i == LEN/8-1 ? temp[i] >> 3 : (temp[i] >> 3) | (temp[i+1] << 5);
        L = extL ^ extR;
        x0[i] = x0[i] ^ x2[i] ^ x3[i] ^ L; // save resulted value of Y0 in x0
    }

    // Compute Y1
    for(i=0 ; i<LEN/8 ; i++)    // temp = x2 ^ x0
        temp[i] = x2[i] ^ x0[i];

    for(i=0 ; i<LEN/8 ; i++){
        extL = i == 0 ? temp[0] << 1 : (temp[i] << 1) | (temp[i-1] >> 7);
        extR = i == LEN/8-1 ? temp[i] >> 3 : (temp[i] >> 3) | (temp[i+1] << 5);
        L = extL ^ extR;
        x1[i] = x1[i] ^ x3[i] ^ x0[i] ^ L; // save resulted value of Y1 in x1
    }

    // Compute Y2
    for(i=0 ; i<LEN/8 ; i++)    // temp = x3 ^ x1
        temp[i] = x3[i] ^ x1[i];

    for(i=0 ; i<LEN/8 ; i++){
        extL = i == 0 ? temp[0] << 1 : (temp[i] << 1) | (temp[i-1] >> 7);
        extR = i == LEN/8-1 ? temp[i] >> 3 : (temp[i] >> 3) | (temp[i+1] << 5);
        L = extL ^ extR;
        x2[i] = x2[i] ^ x0[i] ^ x1[i] ^ L; // save resulted value of Y2 in x2
    }

    // Compute Y3
    for(i=0 ; i<LEN/8 ; i++)    // temp = x2 ^ x0
        temp[i] = x0[i] ^ x2[i];

    for(i=0 ; i<LEN/8 ; i++){
        extL = i == 0 ? temp[0] << 1 : (temp[i] << 1) | (temp[i-1] >> 7);
        extR = i == LEN/8-1 ? temp[i] >> 3 : (temp[i] >> 3) | (temp[i+1] << 5);
        L = extL ^ extR;
        x3[i] = x3[i] ^ x1[i] ^ x2[i] ^ L; // save resulted value of Y3 in x3
    }

}

void transformation_D2(unsigned char *x0,
                       unsigned char *x1,
                       unsigned char *x2,
                       unsigned char *x3)
{
    // Y0 = X0 ^ X2 ^ X3 ^ L(X1 ^ X3)
    // Y1 = X1 ^ X3 ^ Y0 ^ L(X2 ^ Y0)
    // Y2 = X2 ^ Y0 ^ Y1 ^ L(X3 ^ Y1)
    // Y3 = X3 ^ Y1 ^ Y2 ^ L(Y0 ^ Y2)
    //
    // L(X) = (X<<1) ^ (X>>3)

    const int LEN = 32;
    unsigned char temp[LEN/8];
    int i;
    unsigned char extL = 0, extR = 0, L = 0;

    // Compute Y0
    for(i=0 ; i<LEN/8 ; i++)    // temp = x1 ^ x3
        temp[i] = x1[i] ^ x3[i];

    for(i=0 ; i<LEN/8 ; i++){
        extL = i == 0 ? temp[0] << 1 : (temp[i] << 1) | (temp[i-1] >> 7);
        extR = i == LEN/8-1 ? temp[i] >> 3 : (temp[i] >> 3) | (temp[i+1] << 5);
        L = extL ^ extR;
        x0[i] = x0[i] ^ x2[i] ^ x3[i] ^ L; // save resulted value of Y0 in x0
    }

    // Compute Y1
    for(i=0 ; i<LEN/8 ; i++)    // temp = x2 ^ x0
        temp[i] = x2[i] ^ x0[i];

    for(i=0 ; i<LEN/8 ; i++){
        extL = i == 0 ? temp[0] << 1 : (temp[i] << 1) | (temp[i-1] >> 7);
        extR = i == LEN/8-1 ? temp[i] >> 3 : (temp[i] >> 3) | (temp[i+1] << 5);
        L = extL ^ extR;
        x1[i] = x1[i] ^ x3[i] ^ x0[i] ^ L; // save resulted value of Y1 in x1
    }

    // Compute Y2
    for(i=0 ; i<LEN/8 ; i++)    // temp = x3 ^ x1
        temp[i] = x3[i] ^ x1[i];

    for(i=0 ; i<LEN/8 ; i++){
        extL = i == 0 ? temp[0] << 1 : (temp[i] << 1) | (temp[i-1] >> 7);
        extR = i == LEN/8-1 ? temp[i] >> 3 : (temp[i] >> 3) | (temp[i+1] << 5);
        L = extL ^ extR;
        x2[i] = x2[i] ^ x0[i] ^ x1[i] ^ L; // save resulted value of Y2 in x2
    }

    // Compute Y3
    for(i=0 ; i<LEN/8 ; i++)    // temp = x2 ^ x0
        temp[i] = x0[i] ^ x2[i];

    for(i=0 ; i<LEN/8 ; i++){
        extL = i == 0 ? temp[0] << 1 : (temp[i] << 1) | (temp[i-1] >> 7);
        extR = i == LEN/8-1 ? temp[i] >> 3 : (temp[i] >> 3) | (temp[i+1] << 5);
        L = extL ^ extR;
        x3[i] = x3[i] ^ x1[i] ^ x2[i] ^ L; // save resulted value of Y3 in x3
    }

}

void transformation_D3(unsigned char *x0,
                       unsigned char *x1,
                       unsigned char *x2,
                       unsigned char *x3)
{
    // Y0 = X0 ^ X2 ^ X3 ^ L(X1 ^ X3)
    // Y1 = X1 ^ X3 ^ Y0 ^ L(X2 ^ Y0)
    // Y2 = X2 ^ Y0 ^ Y1 ^ L(X3 ^ Y1)
    // Y3 = X3 ^ Y1 ^ Y2 ^ L(Y0 ^ Y2)
    //
    // L(X) = (X^(X<<1)) <<< 1

    unsigned char temp, L = 0;

    // Compute Y0
    temp = (*x1) ^ (*x3);
    L = temp ^ (temp << 1);
    L = (L << 1) | (L >> 7); // Left-Rotate L
    x0[0] = x0[0] ^ x2[0] ^ x3[0] ^ L; // save resulted value of Y0 in x0

    // Compute Y1
    temp = (*x2) ^ (*x0);
    L = temp ^ (temp << 1);
    L = (L << 1) | (L >> 7); // Left-Rotate L
    x1[0] = x1[0] ^ x3[0] ^ x0[0] ^ L; // save resulted value of Y1 in x1

    // Compute Y2
    temp = (*x3) ^ (*x1);
    L = temp ^ (temp << 1);
    L = (L << 1) | (L >> 7); // Left-Rotate L
    x2[0] = x2[0] ^ x0[0] ^ x1[0] ^ L; // save resulted value of Y2 in x2

    // Compute Y3
    temp = (*x0) ^ (*x2);
    L = temp ^ (temp << 1);
    L = (L << 1) | (L >> 7); // Left-Rotate L
    x3[0] = x3[0] ^ x1[0] ^ x2[0] ^ L; // save resulted value of Y3 in x3

}
